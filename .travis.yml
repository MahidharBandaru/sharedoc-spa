language: node_js
node_js:
- stable
cache:
  npm: false

jobs:
  include:
    - stage: unit tests
      script: npm test
    - stage: build
      script:
      - npm run build
    - stage: deploy to staging
      if: branch=master
      script: skip
      deploy: &heroku
        provider: heroku
        app: share-doc-staging
        api_key: $HEROKU_AUTH_TOKEN
    - stage: test staging
      if: branch=master
      script: 'curl https://share-doc-staging.herokuapp.com'
    - stage: deploy to production
      if: branch=master
      script: skip
      deploy:
       <<: *heroku
       app: share-doc
    - stage: test production
      if: branch=master
      script: 'curl https://share-doc.herokuapp.com'
